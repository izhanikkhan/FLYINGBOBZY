<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Babar Bird Game</title>
<style>
  *{margin:0;padding:0;box-sizing:border-box}
  html,body{
    height:100%;
    overflow:hidden;
    display:flex;
    justify-content:center;
    align-items:center;
    background:#000;
    font-family:Arial, sans-serif;
  }
  canvas{display:block;}

  #playAgain, #menu, #settings, #backFromGame {
    position:absolute;
    left:50%;
    transform:translateX(-50%);
    z-index:10;
  }

  #playAgain {
    top:50px;
    background:#ffeb3b;
    color:#000;
    border:none;
    font-size:22px;
    padding:12px 28px;
    border-radius:10px;
    font-weight:bold;
    box-shadow:0 4px 10px rgba(0,0,0,0.3);
    cursor:pointer;
    display:none;
  }
  #playAgain:active {transform:translateX(-50%) scale(0.95);}

  #menu, #settings {
    top:50%;
    transform:translate(-50%, -50%);
    text-align:center;
  }

  #menu button, #settings button, #backFromGame {
    display:block;
    margin:12px auto;
    padding:14px 36px;
    font-size:22px;
    border:none;
    border-radius:10px;
    font-weight:bold;
    cursor:pointer;
    box-shadow:0 4px 10px rgba(0,0,0,0.3);
  }

  #menu button {background:#4caf50;color:#fff;}
  #settings button {background:#2196f3;color:#fff;}
  .backBtn, #backFromGame {background:#f44336 !important;color:#fff;}

  .slider-container {
    color:white;
    font-size:18px;
    margin-top:20px;
  }

  input[type=range] {width:200px;}

  /* âœ¨ Credit text styling */
  #credit {
    color:#fff;
    font-size:18px;
    margin-top:25px;
    text-shadow:0 0 8px #00e5ff;
    opacity:0;
    animation:fadeIn 2s forwards;
  }

  @keyframes fadeIn {
    from {opacity:0;}
    to {opacity:1;}
  }
</style>
</head>
<body>
<canvas id="gameCanvas"></canvas>

<!-- Main Menu -->
<div id="menu">
  <button id="playBtn">PLAY</button>
  <button id="settingsBtn">SETTINGS</button>
  <p id="credit">Created by <b>Izhan Khan</b></p>
</div>

<!-- Settings -->
<div id="settings" style="display:none;">
  <h2 style="color:white;">ðŸŽµ Select Song</h2>
  <button id="song1Btn">CHEQUE SONG</button>
  <button id="song2Btn">RUSSIAN BANDANA SONG</button>

  <div class="slider-container">
    <label for="volumeSlider">Volume:</label><br>
    <input type="range" id="volumeSlider" min="0" max="1" step="0.05" value="1">
  </div>

  <button class="backBtn" id="backBtn">BACK</button>
</div>

<!-- Back button during "Tap to Start" -->
<button id="backFromGame" style="top:20px;display:none;">BACK</button>

<!-- Play Again -->
<button id="playAgain">Play Again</button>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

const playAgainBtn = document.getElementById("playAgain");
const menuDiv = document.getElementById("menu");
const settingsDiv = document.getElementById("settings");
const playBtn = document.getElementById("playBtn");
const settingsBtn = document.getElementById("settingsBtn");
const backBtn = document.getElementById("backBtn");
const backFromGame = document.getElementById("backFromGame");
const song1Btn = document.getElementById("song1Btn");
const song2Btn = document.getElementById("song2Btn");
const volumeSlider = document.getElementById("volumeSlider");

function resizeCanvas(){
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
resizeCanvas();
window.addEventListener("resize", resizeCanvas);

let frames = 0;
const DEG = Math.PI/180;
const state = {menu: -1, current: 0, getReady: 0, game: 1, over: 2};

// Images
const bgImg = new Image(); bgImg.src = "WC.jpeg";
const birdImg = new Image(); birdImg.src = "BABAR.png";
const sadImg = new Image(); sadImg.src = "SAD.jpeg";
const pipeImg = new Image(); pipeImg.src = "AS.jpeg";

// Audios
const playAudio1 = new Audio("CHEQ.mp3");
const playAudio2 = new Audio("RSA.mp3");
let currentAudioElement = playAudio1;
let selectedSong = 0; // 0=CHEQ, 1=RSA

volumeSlider.addEventListener("input", () => {
  currentAudioElement.volume = volumeSlider.value;
});

song1Btn.addEventListener("click", () => {
  selectedSong = 0;
  currentAudioElement = playAudio1;
  alert("Selected: CHEQUE SONG ðŸŽ¶");
});
song2Btn.addEventListener("click", () => {
  selectedSong = 1;
  currentAudioElement = playAudio2;
  alert("Selected: RUSSIAN BANDANA SONG ðŸŽ¶");
});

settingsBtn.addEventListener("click", () => {
  menuDiv.style.display = "none";
  settingsDiv.style.display = "block";
});
backBtn.addEventListener("click", () => {
  settingsDiv.style.display = "none";
  menuDiv.style.display = "block";
});

playBtn.addEventListener("click", () => {
  menuDiv.style.display = "none";
  state.current = state.getReady;
  bird.reset(); // fix falling issue
  backFromGame.style.display = "block";
});

// Sad audio
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
let sadAudioBuffer;
fetch('SAPNA.mp3')
  .then(response => response.arrayBuffer())
  .then(arrayBuffer => audioCtx.decodeAudioData(arrayBuffer))
  .then(buffer => { sadAudioBuffer = buffer; });

function playSadAudio(){
  const source = audioCtx.createBufferSource();
  source.buffer = sadAudioBuffer;
  const gainNode = audioCtx.createGain();
  gainNode.gain.value = 2.0;
  source.connect(gainNode).connect(audioCtx.destination);
  source.start(0);
  return source;
}

// Back from "Tap to Start" to main menu
backFromGame.addEventListener("click", () => {
  state.current = state.menu;
  backFromGame.style.display = "none";
  menuDiv.style.display = "block";
  currentAudioElement.pause();
  currentAudioElement.currentTime = 0;
  bird.reset();
  pipes.reset();
  score.reset();
});

// Controls
canvas.addEventListener("click", () => {
  if(state.current === state.getReady){
    state.current = state.game;
    backFromGame.style.display = "none";
    currentAudioElement.pause();
    currentAudioElement = selectedSong === 0 ? playAudio1 : playAudio2;
    currentAudioElement.loop = true;
    currentAudioElement.volume = volumeSlider.value;
    currentAudioElement.currentTime = 0;
    currentAudioElement.play();
  } else if(state.current === state.game){
    bird.flap();
  }
});

playAgainBtn.addEventListener("click", () => {
  restartGame();
  playAgainBtn.style.display = "none";
});

const bird = {
  x: 80,
  y: canvas.height/2,
  r: 20,
  gravity: 0.25,
  jump: 4.6,
  speed: 0,
  rotation: 0,
  draw(){
    ctx.save();
    ctx.translate(this.x,this.y);
    ctx.rotate(this.rotation);
    ctx.drawImage(birdImg,-this.r,-this.r,this.r*2,this.r*2);
    ctx.restore();
  },
  flap(){this.speed=-this.jump;},
  update(){
    if(state.current===state.getReady){
      this.y=canvas.height/2;
      this.rotation=0;
    }else{
      this.speed+=this.gravity;
      this.y+=this.speed;
      if(this.y+this.r>=canvas.height){
        this.y=canvas.height-this.r;
        if(state.current===state.game){gameOver();}
      }
    }
    this.rotation=this.speed>=this.jump?90*DEG:-25*DEG;
  },
  reset(){this.speed=0;this.y=canvas.height/2;}
};

const pipes={
  pos:[],w:80,baseSpeed:3,dx:3,
  draw(){
    for(let p of this.pos){
      ctx.drawImage(pipeImg,p.x,0,this.w,p.topHeight);
      ctx.drawImage(pipeImg,p.x,p.bottomY,this.w,canvas.height-p.bottomY);
    }
  },
  update(){
    if(state.current!==state.game)return;
    if(frames%90===0){
      const topPercent = 27 + Math.random()*(50-27);
      const bottomPercent = 77 - topPercent;
      const topHeight = canvas.height*(topPercent/100);
      const bottomY = canvas.height*(1-bottomPercent/100);
      this.pos.push({x:canvas.width,topHeight,bottomY});
    }
    for(let i=0;i<this.pos.length;i++){
      let p=this.pos[i];
      p.x -= this.dx;
      if(
        bird.x + bird.r > p.x &&
        bird.x - bird.r < p.x + this.w &&
        (bird.y - bird.r < p.topHeight || bird.y + bird.r > p.bottomY)
      ){gameOver();}
      if(p.x + this.w <= 0){
        this.pos.shift();
        score.value++;
        if(score.value>score.best)score.best=score.value;
        this.dx *= 1.01;
      }
    }
  },
  reset(){this.pos=[];this.dx=this.baseSpeed;}
};

const score={
  value:0,best:0,
  draw(){
    ctx.fillStyle="#fff";
    ctx.strokeStyle="#000";
    ctx.lineWidth=2;
    ctx.textAlign="center";
    if(state.current===state.game){
      ctx.font=`${Math.floor(canvas.width/10)}px Arial`;
      ctx.fillText(this.value,canvas.width/2,80);
    }else if(state.current===state.over){
      const imgW=300,imgH=200;
      ctx.drawImage(sadImg,canvas.width/2-imgW/2,canvas.height/2-imgH/2,imgW,imgH);
      ctx.font=`${Math.floor(canvas.width/15)}px Arial`;
      ctx.fillText("GHANTE KA KING ðŸ””",canvas.width/2,canvas.height/2+120);
      ctx.font=`${Math.floor(canvas.width/20)}px Arial`;
      ctx.fillText(`Best: ${this.best}`,canvas.width/2,canvas.height/2+160);
    }else if(state.current===state.getReady){
      ctx.font=`${Math.floor(canvas.width/15)}px Arial`;
      ctx.fillText("Tap to Start",canvas.width/2,canvas.height/2);
    }
  },
  reset(){this.value=0;}
};

let sadSource;
function gameOver(){
  state.current=state.over;
  currentAudioElement.pause();
  currentAudioElement.currentTime=0;
  if(sadSource) sadSource.stop();
  sadSource = playSadAudio();
  playAgainBtn.style.display="block";
}

function restartGame(){
  if(sadSource) sadSource.stop();
  currentAudioElement.pause();
  currentAudioElement.currentTime=0;
  pipes.reset();
  bird.reset();
  score.reset();
  state.current=state.getReady;
  backFromGame.style.display="block";
}

function draw(){
  ctx.drawImage(bgImg,0,0,canvas.width,canvas.height);
  pipes.draw();
  bird.draw();
  score.draw();
}

function update(){bird.update();pipes.update();}

function loop(){
  update();
  draw();
  frames++;
  requestAnimationFrame(loop);
}

state.current = state.menu;
loop();
</script>
</body>
 </html>
